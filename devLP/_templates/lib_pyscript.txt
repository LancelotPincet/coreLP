#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Author        : Lancelot PINCET
Email         : lancelot.pincet@free.fr
Date          : template_date
Description   : Create new script for template_name
"""



# %% Libraries
from devlp import path
from datetime import datetime
import os



# %% Main function
def main() :
    print('\nRunning add_script :')

    # Ask for script name
    already_exists = True
    while already_exists :
        name = input('     New script name ? >>> ')
        script_path = path.parent / f'libsLP/template_name/scripts/{name}_LP'
        if script_path.exists() :
            print('     This script already exists :/')
        else :
            already_exists = False
    description = input('     what will the script do ? >>> ')
    date = datetime.now().strftime("%Y-%m-%d")

    # Print informations
    print(f'     name : {name}')
    print(f'     description : {description}')
    print(f'     date : {date}')
    os.mkdir(script_path)

    # Write python script
    python_path = path/'_templates/lib_script.txt'
    newpython_path = script_path/f'{name}.py'
    with open(python_path, "r") as file :
        string = file.read()
    string = string.replace('template_scriptname', name)
    string = string.replace('template_scriptdate', date)
    string = string.replace('template_scriptdescription', description)
    with open(newpython_path, "w") as file :
        file.write(string)
    print('     Script file written [to complete]')

    # Add script to project
    toml_path = path.parent / f'libsLP/template_name/pyproject.toml'
    with open(toml_path, "r") as file:
        data = toml.load(file)
    data.setdefault("project", {}).setdefault("scripts", {})[name] = f"template_lowername:{name}"
    with open(toml_path, "w") as file:
        toml.dump(data, file)
    print(f'     Script was added to project')

    # End
    print('add_script finished!\n')



# %% Main function run
if __name__ == "__main__":
    main()